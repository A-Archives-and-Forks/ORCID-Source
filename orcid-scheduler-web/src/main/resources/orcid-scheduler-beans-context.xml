<?xml version="1.0" encoding="UTF-8" ?>
<!--suppress SpringSecurityFiltersConfiguredInspection -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jms="http://www.springframework.org/schema/jms"   
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd
       		http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-4.3.xsd">

    <import resource="classpath*:orcid-core-context.xml"/>
    <import resource="classpath*:statistics-persistence-context.xml" />

    <context:component-scan
		base-package="org.orcid.scheduler.loader" />

    <bean id="authorizationCodeCleaner" class="org.orcid.core.cron.impl.AuthorizationCodeCleanerCronJobImpl" />

	<!-- JMS Messaging -->
	<!-- enable the configuration of jms on annotations -->
	<jms:annotation-driven/>
	
	 <!-- so we can listen to queues -->
    <bean id="jmsListenerContainerFactory"
        class="org.springframework.jms.config.DefaultJmsListenerContainerFactory">
        <property name="connectionFactory" ref="jmsConnectionFactory" />
        <property name="errorHandler" ref="emailQueueErrorHandler" />
        <property name="concurrency" value="1" />
        
        <!-- client acknowledge -->
        <property name="sessionAcknowledgeMode" value="2" />
    </bean>
	
	<bean id="jmsMessageSender" class="org.orcid.core.messaging.JmsMessageSender">
		<property name="enabled" value="${org.orcid.persistence.messaging.enabled:false}"/>
	</bean>
	
	<bean id="orcidRecordIndexer" class="org.orcid.scheduler.indexer.impl.OrcidRecordIndexerImpl" />
	
	<!-- PUBLIC API VALIDATION - the following beans can be removed once we have validated (and fixed) all profiles against public api v3 -->
	<bean id="publicProfileValidator" class="org.orcid.scheduler.validation.PublicProfileValidator">
	    <constructor-arg value="${org.orcid.scheduler.api.profile.validation.baseUrl:https://localhost:8443/orcid-pub-web/v3.0/}" />
	    <constructor-arg value="${org.orcid.scheduler.api.profile.validation.developmentMode:false}" />
	</bean>
	
	<bean id="emailQueueListener" class="org.orcid.scheduler.email.trickle.listener.EmailQueueListener" >
	   <property name="trickleManager" ref="trickleManager" />
	</bean>
	
	<bean id="emailQueueErrorHandler" class="org.orcid.scheduler.email.trickle.EmailTrickleErrorHandler" />
	
	<bean id="trickleManager" class="org.orcid.scheduler.email.trickle.manager.impl.TrickleManagerImpl" />	

	<bean id="mailGunManager" class="org.orcid.utils.email.MailGunManager">
		<constructor-arg value="${com.mailgun.apiKey:XXXX}"/>
	</bean>
	
	<bean id="emailMessageSender" class="org.orcid.scheduler.email.cli.manager.EmailMessageSenderImpl" />
	
	<bean id="ringgoldFtpsFileDownloader" class="org.orcid.scheduler.loader.io.FtpsFileDownloader" />

	<bean id="fundrefOrgDataClient" class="org.orcid.scheduler.loader.io.OrgDataClient" />

	<bean id="gridOrgDataClient" class="org.orcid.scheduler.loader.io.OrgDataClient" />
    
	<bean id="rorOrgDataClient" class="org.orcid.scheduler.loader.io.OrgDataClient" />
	
    <bean id="rorOrgDataSource" class="org.orcid.scheduler.loader.source.ror.RorOrgLoadSource" />
    <bean id="fundrefOrgDataSource" class="org.orcid.scheduler.loader.source.fundref.FundrefOrgLoadSource" />
    <bean id="ringgoldOrgDataSource" class="org.orcid.scheduler.loader.source.ringgold.RinggoldOrgLoadSource" />

    <bean id="jerseyClientHelper" class="org.orcid.utils.jersey.JerseyClientHelper">
        <constructor-arg value="${org.orcid.message-listener.development_mode:false}"/>
    </bean>
	
    <bean id="jerseyClientHelperDevelopmentMode" class="org.orcid.utils.jersey.JerseyClientHelper">
        <constructor-arg value="true"/>
    </bean>
    
    <bean id="jerseyClientHelperForOrgLoaders" class="org.orcid.utils.jersey.JerseyClientHelper">
        <constructor-arg>
        	<list value-type="java.lang.Class">
        		<value>org.orcid.scheduler.jersey.ZenodoRecordsJsonBodyReader</value>
        	</list>
        </constructor-arg>
    </bean>
    

    <bean id="identityProviderLoader" class="org.orcid.scheduler.tasks.impl.IdentityProviderLoaderImpl" />

    <bean id="slackManager" class="org.orcid.utils.alerting.impl.SlackManagerImpl" />

	<bean id="statisticsManager" class="org.orcid.scheduler.cron.stats.impl.StatisticsManagerImpl"/>

</beans>
